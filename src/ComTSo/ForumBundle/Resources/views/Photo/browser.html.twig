{% extends 'ComTSoForumBundle::layout.html.twig' %}

{% block main_content %}
	<div class="modal fade" id="photo-browser" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<h4 class="modal-title">Photo Browser</h4>
				</div>
				<div class="modal-body">
					<h3>Ajout de photos</h3>
					<form id="fileupload" action="{{ oneup_uploader_endpoint('photos') }}" method="POST" enctype="multipart/form-data">
						<!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
						<div class="fileupload-buttonbar">
							<div class="btn-group">
								<!-- The fileinput-button span is used to style the file input field as button -->
								<span class="btn btn-success fileinput-button" title="Ajouter des photos">
									<i class="glyphicon glyphicon-plus"></i>
									<span>Ajouter</span>
									<input type="file" name="files[]" multiple>
								</span>
								<button type="reset" class="btn btn-warning cancel" title="Annuler tout">
									<i class="glyphicon glyphicon-ban-circle"></i>
									<span>Annuler</span>
								</button>
								<button type="button" class="btn btn-danger delete" title="Supprimer les uploads">
									<i class="glyphicon glyphicon-trash"></i>
									<span>Supprimer</span>
								</button>
								<button type="submit" class="btn btn-primary start" title="Commencer Ã  envoyer les fichiers">
									<i class="glyphicon glyphicon-upload"></i>
									<span>Lancer l'upload</span>
								</button>
							</div>
							<span class="fileupload-process"></span>
							<!-- The global progress state -->
							<div class="fileupload-progress fade">
								<!-- The global progress bar -->
								<div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
									<div class="progress-bar progress-bar-success" style="width:0%;"></div>
								</div>
								<!-- The extended global progress state -->
								<div class="progress-extended">&nbsp;</div>
							</div>
						</div>
						<!-- The table listing the files available for upload/download -->
						<table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
					</form>
					{% include 'ComTSoForumBundle:Pagination:pager.html.twig' with {'results': photos} %}
					<h3>Photos existantes</h3>
					<div class="clear"></div>
					<table class="table photo-selector">
						<thead>
							<tr>
								<th>Miniature</th>
								<th>Titre</th>
								<th>Auteur</th>
								<th>Date de prise</th>
								<th>Date d'upload</th>
							</tr>
						</thead>
						<tbody>
							{% for photo in photos %}
								{% include 'ComTSoForumBundle:Photo:selector.html.twig' %}
							{% endfor %}
						</tbody>
					</table>
					{% include 'ComTSoForumBundle:Pagination:pager.html.twig' with {'results': photos} %}
					<div class="clear"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		$(document).ready(function() {
			$('#photo-browser').modal();
			// Initialize the jQuery File Upload widget:
			$('#fileupload').fileupload({
				// Uncomment the following to send cross-domain cookies:
				//xhrFields: {withCredentials: true},
				url: '{{ oneup_uploader_endpoint('photos') }}',
				// Enable image resizing, except for Android and Opera,
				// which actually support image resizing, but fail to
				// send Blob objects via XHR requests:
				disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),
				maxFileSize: 5000000,
				acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
				done: function(e) {
					console.log(e);
				}
			});
		});
	</script>
{% endblock %}
